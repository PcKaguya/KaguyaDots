#!/usr/bin/env sh
# Safe Dolphin launcher for Hyprland with KDE/Qt theming
# Usage: dolphin-kde /path/to/folder-or-file ...

set -eu

# Set clean KDE environment for Dolphin
export XDG_CURRENT_DESKTOP=KDE
export QT_QPA_PLATFORMTHEME=kde
export QT_STYLE_OVERRIDE=Breeze
export KDE_FULL_SESSION=1

# Launch system Dolphin if available
if command -v dolphin >/dev/null 2>&1; then
  exec dolphin "$@"
# Fall back to Flatpak Dolphin if installed
elif command -v flatpak >/dev/null 2>&1 && flatpak info org.kde.dolphin >/dev/null 2>&1; then
  exec flatpak run --env=QT_QPA_PLATFORMTHEME=kde \
                   --env=QT_STYLE_OVERRIDE=Breeze \
                   --env=KDE_FULL_SESSION=1 \
                   org.kde.dolphin "$@"
# Last-resort fallback to xdg-open
else
  if [ "$#" -gt 0 ]; then
    exec xdg-open "$1"
  else
    exec xdg-open .
  fi
fi
